(function(e){"use strict";var t;e.registerPlugin(bkClass.extend({construct:function(e){if(e.options.pasteMode!=="allow"){this.ne=e;e.addEvent("add",this.add.closureListener(this));this.pasteCache=""}},add:function(e){this.elm=e.elm;this.elm.addEvent("paste",this.initPasteClean.closureListener(this))},cleanup:function(e){},initPasteClean:function(){this.pasteCache=this.elm.innerHTML;setTimeout(this.pasteClean.closure(this),100)},pasteClean:function(){var e="",t="",n=this.elm.innerHTML,r=0,i=0,s="",o;this.ne.fireEvent("get",this);for(r=0;n.charAt(r)===this.pasteCache.charAt(r);r++){e+=this.pasteCache.charAt(r)}for(o=r;o>=0;o--){if(this.pasteCache.charAt(o)=="<"){r=o;e=this.pasteCache.substring(0,r);break}else if(this.pasteCache.charAt(o)===">"){break}}n=this.reverse(n);this.pasteCache=this.reverse(this.pasteCache);for(i=0;n.charAt(i)==this.pasteCache.charAt(i);i++){t+=this.pasteCache.charAt(i)}for(o=i;o>=0;o--){if(this.pasteCache.charAt(o)==">"){i=o;t=this.pasteCache.substring(0,i);break}else if(this.pasteCache.charAt(o)=="<"){break}}t=this.reverse(t);if(r==n.length-i){return false}n=this.reverse(n);s=n.substring(r,n.length-i);s=this.cleanPaste(s);this.content=e+s+t;this.ne.fireEvent("set",this);this.elm.innerHTML=this.content},reverse:function(e){var t="",n;for(n=e.length-1;n>=0;n--){t+=e.charAt(n)}return t},cleanPaste:function(e){var t,n;if(!t){t=document.createElement("div")}t.innerHTML=e;return t.innerText||t.textContent}}))})(nicEditors);